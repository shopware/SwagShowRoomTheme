{% sw_extends '@Storefront/storefront/page/account/order-history/order-detail.html.twig' %}

{% block page_account_order_item_detail_table_header %}
    <div class="d-sm-block order-detail-content-header-line"></div>
    {{ parent() }}
{% endblock %}

{% block page_account_order_item_detail_table_labels_summary %}
    <div class="order-item-detail-footer">
        <div class="row no-gutters order-item-detail-footer-container">
            <div class="col-12 col-md-7 col-xl-8">
                <dl class="row no-gutters order-item-detail-labels">
                    {% block page_account_order_item_detail_date %}
                        {% block page_account_order_item_detail_date_label %}
                            <dt class="col-6 col-md-4 col-xl-3">{{ "account.orderItemDate"|trans|sw_sanitize }}</dt>
                        {% endblock %}

                        {% block page_account_order_item_detail_date_value %}
                            <dd class="col-6 col-md-8 col-xl-9 order-item-detail-labels-value">{{ order.orderDateTime|format_date('short', locale=app.request.locale) }}</dd>
                        {% endblock %}
                    {% endblock %}

                    {% block page_account_order_item_detail_number %}
                        {% block page_account_order_item_detail_number_label %}
                            <dt class="col-6 col-md-4 col-xl-3">{{ "account.orderItemNumber"|trans|sw_sanitize }}</dt>
                        {% endblock %}

                        {% block page_account_order_item_detail_number_value %}
                            <dd class="col-6 col-md-8 col-xl-9 order-item-detail-labels-value">{{ order.orderNumber }}</dd>
                        {% endblock %}
                    {% endblock %}

                    {% block page_account_order_item_detail_payment_method %}
                        {% if order.transactions|length > 0 %}
                            {% block page_account_order_item_detail_payment_method_label %}
                                <dt class="col-6 col-md-4 col-xl-3">{{ "account.orderItemPaymentMethod"|trans|sw_sanitize }}</dt>
                            {% endblock %}

                            {% block page_account_order_item_detail_payment_method_value %}
                                <dd class="col-6 col-md-8 col-xl-9 order-item-detail-labels-value">
                                    {{ order.transactions|last.paymentMethod.translated.name }}
                                </dd>
                            {% endblock %}
                        {% endif %}
                    {% endblock %}

                    {% block page_account_order_item_detail_shipping_method %}
                        {% if order.deliveries|length > 0 %}
                            {% block page_account_order_item_detail_shipping_method_label %}
                                <dt class="col-6 col-md-4 col-xl-3">{{ "account.orderItemShippingMethod"|trans|sw_sanitize }}</dt>
                            {% endblock %}

                            {% block page_account_order_item_detail_shipping_method_value %}
                                <dd class="col-6 col-md-8 col-xl-9 order-item-detail-labels-value">
                                    {{ order.deliveries|first.shippingMethod.translated.name }}
                                </dd>
                            {% endblock %}
                        {% endif %}
                    {% endblock %}

                    {% block page_account_order_item_detail_tracking_code %}
                        {% if order.deliveries|length > 0 %}
                            {% block page_account_order_item_detail_tracking_code_label %}
                                <dt class="col-6 col-md-4 col-xl-3">{{ "account.orderItemTracking"|trans|sw_sanitize }}</dt>
                            {% endblock %}

                            {% block page_account_order_item_detail_tracking_code_label_value %}
                                {% apply spaceless %}
                                    <dd class="col-6 col-md-8 col-xl-9">
                                        {% set totalOutput = 0 %}

                                        {% for delivery in order.deliveries %}
                                            {% set trackingCodes = delivery.trackingCodes %}
                                            {% set trackingUrl = delivery.shippingMethod.translated.trackingUrl %}

                                            {% for trackingCode in trackingCodes %}
                                                {% if trackingUrl %}
                                                    {% set output %}
                                                        <a href="{{ trackingUrl|format(trackingCode) }}" target="_blank" rel="noopener">{{ trackingCode }}</a>
                                                    {% endset %}
                                                {% else %}
                                                    {% set output %}
                                                        <span>{{ trackingCode }}</span>
                                                    {% endset %}
                                                {% endif %}

                                                {% set totalOutput = totalOutput + 1 %}

                                                {% if totalOutput > 1 %}<span>, </span>{% endif %}{{ output }}
                                            {% endfor %}
                                        {% endfor %}
                                    </dd>
                                {% endapply %}
                            {% endblock %}
                        {% endif %}
                    {% endblock %}
                </dl>
            </div>

            <div class="col-12 col-md-5 col-xl-4">
                {% block page_account_order_item_detail_summary %}
                    <dl class="row no-gutters order-item-detail-summary">
                        {% block page_account_order_item_detail_shipping_costs %}
                            {% block page_account_order_item_detail_shipping_costs_label %}
                                <dt class="col-6 col-md-6 order-item-detail-summary-shipping-costs-label">
                                    {{ "account.orderItemShippingcosts"|trans|sw_sanitize }}
                                </dt>
                            {% endblock %}

                            {% block page_account_order_item_detail_shipping_costs_value %}
                                <dd class="col-6 col-md-6 order-item-detail-summary-shipping-costs-value">
                                    {{ order.shippingTotal|currency }}
                                </dd>
                            {% endblock %}
                        {% endblock %}

                        {% block page_account_order_item_detail_amount %}
                            {% block page_account_order_item_detail_amount_label %}
                                <dt class="col-6 col-md-6 order-item-detail-amount-label">
                                    {% if order.isTaxFree %}
                                        {{ "account.orderItemNetTotal"|trans|sw_sanitize }}
                                    {% else %}
                                        {{ "account.orderItemTotal"|trans|sw_sanitize }}
                                    {% endif %}
                                </dt>
                            {% endblock %}

                            {% block page_account_order_item_detail_amount_value %}
                                <dd class="col-6 col-md-6 order-item-detail-amount-value">
                                    {% if order.isTaxFree %}
                                        {{ order.amountNet|currency }}
                                    {% else %}
                                        {{ order.amountTotal|currency }}
                                    {% endif %}
                                </dd>
                            {% endblock %}
                        {% endblock %}
                    </dl>
                {% endblock %}
            </div>
        </div>
    </div>
{% endblock %}
